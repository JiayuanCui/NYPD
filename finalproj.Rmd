--- 
title: "NYPD Complaint Data Current"
author: "Jiayuan Cui, Yujie Zhou, Xuchen Wang"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```

# Introduction


<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data sources
NYPD Complaint Data Current (Year To Date) is a dataset provided by the New York City Police Department (NYPD), containing the data for all valid felony, misdemeanor, and violation crimes reported to NYPD for all complete quarters so far this year (2021). 
Crime data for city of NYC available from NYC Open Data at: https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Current-Year-To-Date-/5uac-w243 

<!--chapter:end:02-data.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data transformation

NYC Open Data provides variety of formats of dataset. Since the data can be exported from the website as a .csv file directly, we read the file using the read.csv method and store the data in the dataframe NYCcrime. 

```{r}
library(ggplot2)
library(dplyr)
library(ggridges)
library(tidyverse)
library(data.table)
```

```{r}
NYCcrime<-read.csv("C:/Users/wxc/Downloads/NYPD_Complaint_Data_Current__Year_To_Date_.csv",na.strings=c("","NA"))
```

The dataset has more than 200,000 rows, and we are interested in the data for this year, so we extracted data from Jan 1, 2021.
Before filtering the data, we check the data structure using str() command. 
CMPLNT_FR_DT is a column of exact date of occurrence for the reported event. 
```{r}
str(NYCcrime)
```

We convert CMPLNT_FR_DT from character data to dates using as.date() to enable easier filter and management of the data. 
```{r}
crime <- NYCcrime%>%
  mutate(ExactDate = as.Date(CMPLNT_FR_DT, format = "%m/%d/%Y" )) %>%
  filter(ExactDate >= as.Date('2021-01-01')) 
  
crime %>% select(CMPLNT_NUM,ExactDate)
```

We want to show the number of crimes in each of the categories in NYC. OFNS_DESC is a column with description of offense corresponding with key code. OFNS_DESC contains 59 crime types. We combine two or more similar categories into one to reduce the the number of crime types to make the analysis more manageable.

```{r}
library(lubridate)
crime$OFNS_DESC <- as.factor(crime$OFNS_DESC)

crime <- crime %>%
  mutate(
    CrimeType=fct_recode(OFNS_DESC,
                     "THEFT CRIMES"="PETIT LARCENY",
                     "HARRASSMENT"="HARRASSMENT 2",
                     "ASSAULT"="ASSAULT 3 & RELATED OFFENSES",
                     "CRIMINAL MISCHIEF"="CRIMINAL MISCHIEF & RELATED OF",
                     "THEFT CRIMES"="GRAND LARCENY",
                     "ASSAULT"="FELONY ASSAULT",
                     "OFFENSES AGAINST PUBLIC SENSIBILITIES"="OFF. AGNST PUB ORD SENSBLTY &",
                     "OTHER"="MISCELLANEOUS PENAL LAW",
                     "THEFT CRIMES"="ROBBERY",
                     "THEFT CRIMES"="BURGLARY",
                     "THEFT CRIMES"="GRAND LARCENY OF MOTOR VEHICLE",
                     "DRUGS"="DANGEROUS DRUGS",
                     "TRAFFIC OFFENSES"="VEHICLE AND TRAFFIC LAWS",
                     "OFFENSES AGAINST PUBLIC ADMINI"="OFFENSES AGAINST PUBLIC ADMINI",
                     "OTHER"="DANGEROUS WEAPONS",
                     "SEX CRIMES"="SEX CRIMES",
                     "FRAUDS"="FORGERY",
                     "FRAUDS"="THEFT-FRAUD",
                     "FRAUDS"="FRAUDS",
                     "FRAUDS"="OFFENSES INVOLVING FRAUD",
                     "ALCOHOL RELATED CRIMES"="INTOXICATED & IMPAIRED DRIVING",
                     "TRESPASS"="CRIMINAL TRESPASS",
                     "THEFT CRIMES"="POSSESSION OF STOLEN PROPERTY",
                     "TRAFFIC OFFENSES"="UNAUTHORIZED USE OF A VEHICLE",
                     "ASSAULT"="OFFENSES AGAINST THE PERSON",
                     "THEFT CRIMES"="RAPE",
                     "OTHER"="ADMINISTRATIVE CODE",
                     "ARSON"="ARSON",
                     "THEFT CRIMES"="OTHER OFFENSES RELATED TO THEF",
                     "HOMICIDE"="MURDER & NON-NEGL. MANSLAUGHTER",
                     "OTHER"="NYS LAWS-UNCLASSIFIED FELONY",
                     "OTHER"="OTHER STATE LAWS (NON PENAL LA",
                     "THEFT CRIMES"="BURGLAR'S TOOLS",
                     "THEFT CRIMES"="PETIT LARCENY OF MOTOR VEHICLE",
                     "GAMBLING"="GAMBLING",
                     "KIDNAPPING"="KIDNAPPING & RELATED OFFENSES",
                     "THEFT CRIMES"="THEFT OF SERVICES",
                     "OTHER"="AGRICULTURE & MRKTS LAW-UNCLASSIFIED",
                     "ALCOHOL RELATED CRIMES"="ALCOHOLIC BEVERAGE CONTROL LAW",
                     "OTHER"="OFFENSES AGAINST PUBLIC SAFETY",
                     "FRAUDS"="FRAUDULENT ACCOSTING",
                     "OTHER"="ANTICIPATORY OFFENSES",
                     "SEX CRIMES"="PROSTITUTION & RELATED OFFENSES",
                     "OTHER"="DISORDERLY CONDUCT",
                     "SEX CRIMES"="FELONY SEX CRIMES",
                     "OTHER"="ENDAN WELFARE INCOMP",
                     "OTHER"="OTHER STATE LAWS",
                     "OTHER"="NYS LAWS-UNCLASSIFIED VIOLATION",
                     "OTHER"="CHILD ABANDONMENT/NON SUPPORT",
                     "KIDNAPPING"="KIDNAPPING",
                     "OTHER"="OFFENSES RELATED TO CHILDREN",
                     "OTHER"="JOSTLING",
                     "ALCOHOL RELATED CRIMES"="INTOXICATED/IMPAIRED DRIVING",
                     "HOMICIDE"="HOMICIDE-NEGLIGENT,UNCLASSIFIE",
                     "OTHER"="ESCAPE 3",
                     "OTHER"="OFFENSES AGAINST MARRIAGE UNCL",
                     "OTHER"="NEW YORK CITY HEALTH CODE",
                     "HOMICIDE"="HOMICIDE-NEGLIGENT-VEHICLE",
                     "OTHER"="DISRUPTION OF A RELIGIOUS SERV"
                     ))
crime %>% select(OFNS_DESC,CrimeType,ExactDate)
```

In order to look at how crimes are distributed with respect to time of day, day of week, and month, we create two columns day and month to show day of week and month of year respectively based on dates.
CMPLNT_FR_TM is a column of exact time of occurrence for the reported event. We convert CMPLNT_FR_TM from character data to ITime using as.ITime(). We mutate a new column Time to show the time of day. If a crime occurs between time “X:00” to time “X:59”, it shows "X" in the column. 
```{r}
crime <- crime %>%
  mutate(day=wday(ExactDate,label=TRUE,abbr=TRUE),
         month=month(ExactDate,label=TRUE,abbr=TRUE)) %>%
  mutate(ExactTime = as.ITime(CMPLNT_FR_TM)) %>%
  mutate(Time = case_when(
    CMPLNT_FR_TM >="00:00:00" & CMPLNT_FR_TM <"01:00:00"~0,
    CMPLNT_FR_TM >="01:00:00" & CMPLNT_FR_TM <"02:00:00"~1,
    CMPLNT_FR_TM >="02:00:00" & CMPLNT_FR_TM <"03:00:00"~2,
    CMPLNT_FR_TM >="03:00:00" & CMPLNT_FR_TM <"04:00:00"~3,
    CMPLNT_FR_TM >="04:00:00" & CMPLNT_FR_TM <"05:00:00"~4,
    CMPLNT_FR_TM >="05:00:00" & CMPLNT_FR_TM <"06:00:00"~5,
    CMPLNT_FR_TM >="06:00:00" & CMPLNT_FR_TM <"07:00:00"~6,
    CMPLNT_FR_TM >="07:00:00" & CMPLNT_FR_TM <"08:00:00"~7,
    CMPLNT_FR_TM >="08:00:00" & CMPLNT_FR_TM <"09:00:00"~8,
    CMPLNT_FR_TM >="09:00:00" & CMPLNT_FR_TM <"10:00:00"~9,
    CMPLNT_FR_TM >="10:00:00" & CMPLNT_FR_TM <"11:00:00"~10,
    CMPLNT_FR_TM >="11:00:00" & CMPLNT_FR_TM <"12:00:00"~11,
    CMPLNT_FR_TM >="12:00:00" & CMPLNT_FR_TM <"13:00:00"~12,
    CMPLNT_FR_TM >="13:00:00" & CMPLNT_FR_TM <"14:00:00"~13,
    CMPLNT_FR_TM >="14:00:00" & CMPLNT_FR_TM <"15:00:00"~14,
    CMPLNT_FR_TM >="15:00:00" & CMPLNT_FR_TM <"16:00:00"~15,
    CMPLNT_FR_TM >="16:00:00" & CMPLNT_FR_TM <"17:00:00"~16,
    CMPLNT_FR_TM >="17:00:00" & CMPLNT_FR_TM <"18:00:00"~17,
    CMPLNT_FR_TM >="18:00:00" & CMPLNT_FR_TM <"19:00:00"~18,
    CMPLNT_FR_TM >="19:00:00" & CMPLNT_FR_TM <"20:00:00"~19,
    CMPLNT_FR_TM >="20:00:00" & CMPLNT_FR_TM <"21:00:00"~20,
    CMPLNT_FR_TM >="21:00:00" & CMPLNT_FR_TM <"22:00:00"~21,
    CMPLNT_FR_TM >="22:00:00" & CMPLNT_FR_TM <"23:00:00"~22,
    CMPLNT_FR_TM >="23:00:00" & CMPLNT_FR_TM <"24:00:00" ~23,
    CMPLNT_FR_TM >="24:00:00" ~24))
crime %>% select(CrimeType,ExactDate,ExactTime,day,month,Time)
```

<!--chapter:end:03-cleaning.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Missing values


```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```



```{r, echo=FALSE}

library(patchwork)
library(d3r)
library(parcoords)
library(ggalluvial)
library(vcd)
library(grid)
library(Lock5withR)
library(GGally)
library(hexbin)
library(MASS)
library(stringr) 
library(boot)
library(agridat)
library(openintro)
library(ggplot2)
library(dplyr)
library(ggridges)
library(tidyverse)
library(grid)
set.seed(5702)
mycars <- mtcars
mycars[1:25, "gear"] <- NA
mycars[10:20, 3:5] <- NA
for (i in 1:10) mycars[sample(32,1), sample(11,1)] <- NA
plot_missing <- function(df,percent) {
  missing_patterns <- data.frame(is.na(df)) %>%
    group_by_all() %>%
    count(name = "count", sort = TRUE) %>%
    ungroup()
  fullcol<-which(apply(missing_patterns, 1, function(r) any(r==TRUE))==FALSE)
  has_fullcol=TRUE
  if(length(fullcol)==0) {
    has_fullcol=FALSE
  }
  first_data<-sapply(df, function(y) sum(length(which(is.na(y)==TRUE))))
  ord<-order(first_data,decreasing=TRUE)
  second_data<-missing_patterns[ord]
  first_data<-first_data[ord]
  third_data<-missing_patterns$count
  d1 <- gather(df, col_name, value) %>%
  group_by(col_name) %>%
  summarize(missing= mean(is.na(value))*100) %>%
  arrange(desc(missing))
  d2 <- third_data/sum(third_data)*100
  real2<-gather(second_data,col_name, value)
  real2$row_num <- seq.int(nrow(real2))
  real2$row_num<-real2$row_num%%length(third_data)
  real2$row_num[real2$row_num==0]<-length(third_data)
  real2$row_num<-as.factor(real2$row_num)
  real2$col_name<-as.factor(real2$col_name)
  real2$value[real2$row_num==fullcol]<-2
  real2$value=as.factor(real2$value)
  lab=sapply((rev(seq.int(length(third_data)))),toString)
  
  colors <- c("#cbcbcb","#b69fe6","#b3b3b3")
  if (!has_fullcol) {
    colors<-c("#cbcbcb","#b69fe6")
  }
  p2<-ggplot(real2, aes(x = fct_relevel(col_name, colnames(df)[ord]), y = fct_relevel(row_num,lab), fill=value)) +
    geom_tile(color = "white",show_guide = FALSE) +
    labs(x="variable",y="missing pattern") +
    scale_fill_manual(values=colors) +
    annotate("text", x = length(first_data)/2, y = length(third_data)-fullcol+1, label = "complete cases") + theme_grey()+theme(axis.text.x = element_text(angle=45, vjust=1, hjust=1))
  
  newdf<-data.frame(num=first_data, key=colnames(df)[ord])
  p1<-0
  if(percent) {
    p1<-d1 %>%
  ggplot() +
    geom_bar(aes(fct_relevel(col_name, colnames(df)[ord]),missing), stat = 'identity',fill="#689af5", alpha = 0.7) + scale_y_continuous(breaks = seq(0, 100, by=25),limits=c(0,100)) +
    labs(x='variable', y="% rows missing:", title='Missing value patterns') +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    axis.text.x = element_text(angle=45, vjust=1, hjust=1)
  )
  } else {
  p1<-newdf %>%
    ggplot() +
    geom_bar(aes(fct_relevel(key, colnames(df)[ord]),num), stat = 'identity',fill="#689af5", alpha = 0.7) + 
    labs(x='variable', y="num rows missing:", title='Missing value patterns') +
    theme(
      panel.grid.major.x = element_blank(),
      panel.grid.minor.x = element_blank(),
      axis.text.x = element_text(angle=45, vjust=1, hjust=1)
    )
}
  
  colors2<-c("0"="#689af5","1"="#0751d5")
  if (!has_fullcol) {
    colors2<-c("#689af5")
  }
  p3<-0
  if(percent) {
   newdf2<-data.frame(x=as.factor(seq(1,length(d2),1)),num=d2,val=rep(0,length(d2) ))
    newdf2$val[fullcol]<-1
    newdf2$val<-as.factor(newdf2$val)
    p3<-newdf2 %>%
  ggplot() +
    geom_bar(aes(reorder(x,rev(seq(1,length(d2),1))),y=num,fill=val),stat = 'identity',position='dodge',alpha=0.7,show.legend = FALSE) +
  labs(y="% rows")+
    scale_fill_manual("legend",values =c("0"="#689af5","1"="#0751d5")) + 
  scale_y_continuous(breaks = seq(0, 100, by=25),limits=c(0,100)) +
   coord_flip()+
 
    theme(axis.title.y=element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.border = element_rect(colour = "black", fill=NA)
    
  ) 
  } else {
     newdf2<-data.frame(x=as.factor(seq(1,length(third_data),1)),num=third_data,val=rep(0,length(third_data)))
  newdf2$val[fullcol]<-1
  newdf2$val<-as.factor(newdf2$val)
    
  p3<-newdf2 %>%
    ggplot() +
    geom_bar(aes(reorder(x,rev(seq(1,length(third_data),1))),num,fill=val),stat = 'identity',position='dodge',alpha=0.7,show.legend = FALSE) +
    labs(y="row count")+
    scale_fill_manual("legend",values =colors2) +
    coord_flip() +
    theme(
      axis.title.y=element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.border = element_rect(colour = "gray39", fill=NA),
    axis.text.x = element_text(angle=45, vjust=1, hjust=1)
  )
  }
  
  plt <- p1+plot_spacer()+p2+p3+plot_layout(width=c(5,1),height=c(1,5))
  
  return(plt)
}


```




```{r, echo=FALSE}
NYCcrime<-read.csv("C:/Users/Dell/Downloads/NYPD_Complaint_Data_Current__Year_To_Date_.csv",na.strings=c("","NA"))
NYC_numeric<- select_if(NYCcrime, is.numeric)

```


Percentage Plot for Numeric columns in NYC crime cases dataset, where each row represents a crime case:

```{r, echo=FALSE,fig.width = 10,fig.height=8}
plot_missing(NYC_numeric,TRUE)
```





In the missing pattern plot, there are only four missing patterns:

1, missing transit_district and housing_psa

2, missing transit_district

3, missing housing_psa

4, missing housing_psa, transit_district, jurisdiction_code and pd_cd

pd_cd is the internal classification code 


We can see that there are no complete cases in this dataset, so all rows have missing values.

It can be observed from the top graph that most of transit_district and housing_psa are missing, which can also be observed in the bottom right graph, where we can see that about 90% of data are missing both transit_district and housing_psa.

Based on these massive missing cases, we can consider removing these two variables.

It can also be observed that there are few cases where we are missing jurisdiction_code and pd_cd, and these two values are missing simultaneously. The jurisdiction code represents the jurisdiction responsible for the crime incident and pd_cd is the internal classification code.

The reason for this phenomenon may be that pd_cd is a code relying on jurisdiction code. The other internal classification code ky_cd which is less granular than pd_cd has no missing values, so it is likely that pd_cd takes jurisdiction in to account when classifying while ky_cd does not.

<!--chapter:end:04-missing.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Results

```{r}
library(patchwork)
library(d3r)
library(parcoords)
library(ggalluvial)
library(vcd)
library(grid)
library(Lock5withR)
library(GGally)
library(hexbin)
library(MASS)
library(stringr) 
library(boot)
library(agridat)
library(openintro)
library(ggplot2)
library(dplyr)
library(ggridges)
library(tidyverse)
library(grid)
library(data.table)
```

```{r}
NYCcrime<-read.csv("C:/Users/Dell/Downloads/NYPD_Complaint_Data_Current__Year_To_Date_.csv")
```


```{r}
crime <- NYCcrime%>%
  mutate(ExactDate = as.Date(CMPLNT_FR_DT, format = "%m/%d/%Y" )) %>%
  filter(ExactDate >= as.Date('2021-01-01'))
```

```{r}
library(lubridate)
crime$OFNS_DESC <- as.factor(crime$OFNS_DESC)

crime <- crime %>%
  mutate(
    CrimeType=fct_recode(OFNS_DESC,
                     "THEFT CRIMES"="PETIT LARCENY",
                     "HARRASSMENT"="HARRASSMENT 2",
                     "ASSAULT"="ASSAULT 3 & RELATED OFFENSES",
                     "CRIMINAL MISCHIEF"="CRIMINAL MISCHIEF & RELATED OF",
                     "THEFT CRIMES"="GRAND LARCENY",
                     "ASSAULT"="FELONY ASSAULT",
                     "OFFENSES AGAINST PUBLIC SENSIBILITIES"="OFF. AGNST PUB ORD SENSBLTY &",
                     "OTHER"="MISCELLANEOUS PENAL LAW",
                     "THEFT CRIMES"="ROBBERY",
                     "THEFT CRIMES"="BURGLARY",
                     "THEFT CRIMES"="GRAND LARCENY OF MOTOR VEHICLE",
                     "DRUGS"="DANGEROUS DRUGS",
                     "TRAFFIC OFFENSES"="VEHICLE AND TRAFFIC LAWS",
                     "OFFENSES AGAINST PUBLIC ADMINI"="OFFENSES AGAINST PUBLIC ADMINI",
                     "OTHER"="DANGEROUS WEAPONS",
                     "SEX CRIMES"="SEX CRIMES",
                     "FRAUDS"="FORGERY",
                     "FRAUDS"="THEFT-FRAUD",
                     "FRAUDS"="FRAUDS",
                     "FRAUDS"="OFFENSES INVOLVING FRAUD",
                     "ALCOHOL RELATED CRIMES"="INTOXICATED & IMPAIRED DRIVING",
                     "TRESPASS"="CRIMINAL TRESPASS",
                     "THEFT CRIMES"="POSSESSION OF STOLEN PROPERTY",
                     "TRAFFIC OFFENSES"="UNAUTHORIZED USE OF A VEHICLE",
                     "ASSAULT"="OFFENSES AGAINST THE PERSON",
                     "THEFT CRIMES"="RAPE",
                     "OTHER"="ADMINISTRATIVE CODE",
                     "ARSON"="ARSON",
                     "THEFT CRIMES"="OTHER OFFENSES RELATED TO THEF",
                     "HOMICIDE"="MURDER & NON-NEGL. MANSLAUGHTER",
                     "OTHER"="NYS LAWS-UNCLASSIFIED FELONY",
                     "OTHER"="OTHER STATE LAWS (NON PENAL LA",
                     "THEFT CRIMES"="BURGLAR'S TOOLS",
                     "THEFT CRIMES"="PETIT LARCENY OF MOTOR VEHICLE",
                     "GAMBLING"="GAMBLING",
                     "KIDNAPPING"="KIDNAPPING & RELATED OFFENSES",
                     "THEFT CRIMES"="THEFT OF SERVICES",
                     "OTHER"="AGRICULTURE & MRKTS LAW-UNCLASSIFIED",
                     "ALCOHOL RELATED CRIMES"="ALCOHOLIC BEVERAGE CONTROL LAW",
                     "OTHER"="OFFENSES AGAINST PUBLIC SAFETY",
                     "FRAUDS"="FRAUDULENT ACCOSTING",
                     "OTHER"="ANTICIPATORY OFFENSES",
                     "SEX CRIMES"="PROSTITUTION & RELATED OFFENSES",
                     "OTHER"="DISORDERLY CONDUCT",
                     "SEX CRIMES"="FELONY SEX CRIMES",
                     "OTHER"="ENDAN WELFARE INCOMP",
                     "OTHER"="OTHER STATE LAWS",
                     "OTHER"="NYS LAWS-UNCLASSIFIED VIOLATION",
                     "OTHER"="CHILD ABANDONMENT/NON SUPPORT",
                     "KIDNAPPING"="KIDNAPPING",
                     "OTHER"="OFFENSES RELATED TO CHILDREN",
                     "OTHER"="JOSTLING",
                     "ALCOHOL RELATED CRIMES"="INTOXICATED/IMPAIRED DRIVING",
                     "HOMICIDE"="HOMICIDE-NEGLIGENT,UNCLASSIFIE",
                     "OTHER"="ESCAPE 3",
                     "OTHER"="OFFENSES AGAINST MARRIAGE UNCL",
                     "OTHER"="NEW YORK CITY HEALTH CODE",
                     "HOMICIDE"="HOMICIDE-NEGLIGENT-VEHICLE",
                     "OTHER"="DISRUPTION OF A RELIGIOUS SERV"
                     )) %>%
  
  mutate(ExactTime = as.ITime(CMPLNT_FR_TM)) %>%
  mutate(day=wday(ExactDate,label=TRUE,abbr=TRUE),
         month=month(ExactDate,label=TRUE,abbr=TRUE)) %>%
  
  mutate(Time = case_when(
    CMPLNT_FR_TM >="00:00:00" & CMPLNT_FR_TM <"01:00:00"~0,
    CMPLNT_FR_TM >="01:00:00" & CMPLNT_FR_TM <"02:00:00"~1,
    CMPLNT_FR_TM >="02:00:00" & CMPLNT_FR_TM <"03:00:00"~2,
    CMPLNT_FR_TM >="03:00:00" & CMPLNT_FR_TM <"04:00:00"~3,
    CMPLNT_FR_TM >="04:00:00" & CMPLNT_FR_TM <"05:00:00"~4,
    CMPLNT_FR_TM >="05:00:00" & CMPLNT_FR_TM <"06:00:00"~5,
    CMPLNT_FR_TM >="06:00:00" & CMPLNT_FR_TM <"07:00:00"~6,
    CMPLNT_FR_TM >="07:00:00" & CMPLNT_FR_TM <"08:00:00"~7,
    CMPLNT_FR_TM >="08:00:00" & CMPLNT_FR_TM <"09:00:00"~8,
    CMPLNT_FR_TM >="09:00:00" & CMPLNT_FR_TM <"10:00:00"~9,
    CMPLNT_FR_TM >="10:00:00" & CMPLNT_FR_TM <"11:00:00"~10,
    CMPLNT_FR_TM >="11:00:00" & CMPLNT_FR_TM <"12:00:00"~11,
    CMPLNT_FR_TM >="12:00:00" & CMPLNT_FR_TM <"13:00:00"~12,
    CMPLNT_FR_TM >="13:00:00" & CMPLNT_FR_TM <"14:00:00"~13,
    CMPLNT_FR_TM >="14:00:00" & CMPLNT_FR_TM <"15:00:00"~14,
    CMPLNT_FR_TM >="15:00:00" & CMPLNT_FR_TM <"16:00:00"~15,
    CMPLNT_FR_TM >="16:00:00" & CMPLNT_FR_TM <"17:00:00"~16,
    CMPLNT_FR_TM >="17:00:00" & CMPLNT_FR_TM <"18:00:00"~17,
    CMPLNT_FR_TM >="18:00:00" & CMPLNT_FR_TM <"19:00:00"~18,
    CMPLNT_FR_TM >="19:00:00" & CMPLNT_FR_TM <"20:00:00"~19,
    CMPLNT_FR_TM >="20:00:00" & CMPLNT_FR_TM <"21:00:00"~20,
    CMPLNT_FR_TM >="21:00:00" & CMPLNT_FR_TM <"22:00:00"~21,
    CMPLNT_FR_TM >="22:00:00" & CMPLNT_FR_TM <"23:00:00"~22,
    CMPLNT_FR_TM >="23:00:00" & CMPLNT_FR_TM <"24:00:00" ~23,
    CMPLNT_FR_TM >="24:00:00" ~24))
```


```{r}
crimetype <- crime %>%
  group_by(CrimeType) %>%
  summarize(count=n()) %>%
  arrange(count) %>%
  na_if("") %>%
  na.omit
```


```{r}
crimetype %>% 
  ggplot(aes(x = reorder(CrimeType,count), y = count)) +
  geom_bar(stat = "identity", fill = "purple") +
  labs(x ="Crime Type", y = "Number of crimes", title = "Crimes in New York") + 
  coord_flip()
```

```{r}
crimedate <- crime %>%
  group_by(ExactDate) %>%
  summarize(count=n())
```

```{r}
crimedate %>%
  ggplot(aes(x=ExactDate, y=count)) +
  geom_line(colour = "blue") + scale_x_date(date_breaks = "3 week") +
  labs(x ="Date", y = "Number of crimes", title = "Crimes by day")
```

```{r}
library(lubridate)
crimemonth <- crime %>%
  group_by(month) %>%
  summarize(count=n())
```


```{r}
crimemonth %>% 
  ggplot(aes(x = month, y = count)) +
  geom_col() +
  labs(x = "Day of week", y = "Number of crimes", title = "Crimes by day of week")
```



```{r}
crimeday <- crime %>% 
  group_by(day) %>%
  summarize(count=n())
```


```{r}
crimeday %>%
  ggplot(aes(x = day, y = count)) +
  geom_col() +
  labs(x = "Day of week", y = "Number of crimes", title = "Crimes by day of week")
```


```{r}
crimetime <- crime %>%
  group_by(Time) %>%
  summarize(count = n()) 
```

```{r}
ggplot(crimetime, aes(x = Time, y = count)) +
  geom_line(colour = "blue", size = 1) +
  scale_x_continuous(breaks=c(0:23)) +
  ggtitle("The total number of crimes by time of day")
```


```{r}
borough <- crime %>%
  select(BORO_NM,Longitude,Latitude,ExactDate) %>%
  na_if("") %>%
  na.omit %>%
  group_by(BORO_NM)  

colnames(borough) <- c('Borough','Longitude','Latitude',"ExactDate")
```

```{r}
borough %>%
  ggplot(aes(x = ExactDate)) +
  geom_histogram(binwidth=5) + scale_x_date(date_breaks = "3 week",date_labels =("%b%d")) + facet_wrap(~Borough)
```


```{r}
ggplot(borough, aes(x = Longitude, y = Latitude)) + geom_point(aes(colour = factor(Borough)), size = 0.1) + 
  theme_light(base_size = 10) + xlab("Longitude") + ylab("Latitude") +
  ggtitle("Borough") + theme(plot.title=element_text(size = 16))
```

```{r}
crime1 <- crime %>%
  group_by(CrimeType,Time) %>%
  summarise(count=n()) %>%
  na_if("") %>%
  na.omit
```

```{r}
crime1 %>%
  ggplot(aes(x=CrimeType, y=Time)) +
  geom_tile(aes(fill=count)) + scale_y_continuous(breaks=c(0:23)) +
  labs(x="Crime Type", y = "Time of day", title="Crime Type VS Time of Day") + coord_flip()
```

```{r}
crime2 <- crime %>%
  group_by(CrimeType,BORO_NM) %>%
  summarise(count=n()) %>%
  na_if("") %>%
  na.omit
```

```{r}
crime2 %>%
  ggplot(aes(x=CrimeType, y=BORO_NM)) +
  geom_tile(aes(fill=count)) +
  labs(x="Crime Type", y = "Borough", title="Crime Type VS Borough") + coord_flip()
```

```{r}
crime3 <- crime %>%
  group_by(BORO_NM,Time) %>%
  summarise(count=n()) %>%
  na_if("") %>%
  na.omit
```

```{r}
crime3 %>%
  ggplot(aes(x=BORO_NM, y=Time)) +
  geom_tile(aes(fill=count)) + scale_y_continuous(breaks=c(0:23)) +
  labs(x="Crime", y = "Time of day", title="Crime Type VS Time of Day") + coord_flip()
```

```{r}
crime4 <- crime %>%
  group_by(CrimeType,day) %>%
  summarise(count=n()) %>%
  na_if("") %>%
  na.omit
```

```{r}
crime4 %>%
  ggplot(aes(x=CrimeType, y=day)) +
  geom_tile(aes(fill=count)) +
  labs(x="Crime", y = "Day of week", title="Crime Type VS Day of week") + coord_flip()
```



<!--chapter:end:05-results.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Interactive component



<!--chapter:end:06-interactive.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Conclusion


<!--chapter:end:07-conclusion.Rmd-->

