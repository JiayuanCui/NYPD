# Results

```{r}
library(ggplot2)
library(dplyr)
library(ggridges)
library(tidyverse)
library(grid)
library(data.table)
```

```{r}
NYCcrime<-read.csv("C:/Users/Dell/Downloads/NYPD_Complaint_Data_Current__Year_To_Date_.csv")
```


```{r}
crime <- NYCcrime%>%
  mutate(ExactDate = as.Date(CMPLNT_FR_DT, format = "%m/%d/%Y" )) %>%
  filter(ExactDate >= as.Date('2021-01-01'))
```

```{r}
library(lubridate)
crime$OFNS_DESC <- as.factor(crime$OFNS_DESC)

crime <- crime %>%
  mutate(
    CrimeType=fct_recode(OFNS_DESC,
                     "THEFT CRIMES"="PETIT LARCENY",
                     "HARRASSMENT"="HARRASSMENT 2",
                     "ASSAULT"="ASSAULT 3 & RELATED OFFENSES",
                     "CRIMINAL MISCHIEF"="CRIMINAL MISCHIEF & RELATED OF",
                     "THEFT CRIMES"="GRAND LARCENY",
                     "ASSAULT"="FELONY ASSAULT",
                     "OFFENSES AGAINST PUBLIC SENSIBILITIES"="OFF. AGNST PUB ORD SENSBLTY &",
                     "OTHER"="MISCELLANEOUS PENAL LAW",
                     "THEFT CRIMES"="ROBBERY",
                     "THEFT CRIMES"="BURGLARY",
                     "THEFT CRIMES"="GRAND LARCENY OF MOTOR VEHICLE",
                     "DRUGS"="DANGEROUS DRUGS",
                     "TRAFFIC OFFENSES"="VEHICLE AND TRAFFIC LAWS",
                     "OFFENSES AGAINST PUBLIC ADMINI"="OFFENSES AGAINST PUBLIC ADMINI",
                     "OTHER"="DANGEROUS WEAPONS",
                     "SEX CRIMES"="SEX CRIMES",
                     "FRAUDS"="FORGERY",
                     "FRAUDS"="THEFT-FRAUD",
                     "FRAUDS"="FRAUDS",
                     "FRAUDS"="OFFENSES INVOLVING FRAUD",
                     "ALCOHOL RELATED CRIMES"="INTOXICATED & IMPAIRED DRIVING",
                     "TRESPASS"="CRIMINAL TRESPASS",
                     "THEFT CRIMES"="POSSESSION OF STOLEN PROPERTY",
                     "TRAFFIC OFFENSES"="UNAUTHORIZED USE OF A VEHICLE",
                     "ASSAULT"="OFFENSES AGAINST THE PERSON",
                     "THEFT CRIMES"="RAPE",
                     "OTHER"="ADMINISTRATIVE CODE",
                     "ARSON"="ARSON",
                     "THEFT CRIMES"="OTHER OFFENSES RELATED TO THEF",
                     "HOMICIDE"="MURDER & NON-NEGL. MANSLAUGHTER",
                     "OTHER"="NYS LAWS-UNCLASSIFIED FELONY",
                     "OTHER"="OTHER STATE LAWS (NON PENAL LA",
                     "THEFT CRIMES"="BURGLAR'S TOOLS",
                     "THEFT CRIMES"="PETIT LARCENY OF MOTOR VEHICLE",
                     "GAMBLING"="GAMBLING",
                     "KIDNAPPING"="KIDNAPPING & RELATED OFFENSES",
                     "THEFT CRIMES"="THEFT OF SERVICES",
                     "OTHER"="AGRICULTURE & MRKTS LAW-UNCLASSIFIED",
                     "ALCOHOL RELATED CRIMES"="ALCOHOLIC BEVERAGE CONTROL LAW",
                     "OTHER"="OFFENSES AGAINST PUBLIC SAFETY",
                     "FRAUDS"="FRAUDULENT ACCOSTING",
                     "OTHER"="ANTICIPATORY OFFENSES",
                     "SEX CRIMES"="PROSTITUTION & RELATED OFFENSES",
                     "OTHER"="DISORDERLY CONDUCT",
                     "SEX CRIMES"="FELONY SEX CRIMES",
                     "OTHER"="ENDAN WELFARE INCOMP",
                     "OTHER"="OTHER STATE LAWS",
                     "OTHER"="NYS LAWS-UNCLASSIFIED VIOLATION",
                     "OTHER"="CHILD ABANDONMENT/NON SUPPORT",
                     "KIDNAPPING"="KIDNAPPING",
                     "OTHER"="OFFENSES RELATED TO CHILDREN",
                     "OTHER"="JOSTLING",
                     "ALCOHOL RELATED CRIMES"="INTOXICATED/IMPAIRED DRIVING",
                     "HOMICIDE"="HOMICIDE-NEGLIGENT,UNCLASSIFIE",
                     "OTHER"="ESCAPE 3",
                     "OTHER"="OFFENSES AGAINST MARRIAGE UNCL",
                     "OTHER"="NEW YORK CITY HEALTH CODE",
                     "HOMICIDE"="HOMICIDE-NEGLIGENT-VEHICLE",
                     "OTHER"="DISRUPTION OF A RELIGIOUS SERV",
                     "GAMBLING"="LOITERING/GAMBLING (CARDS, DIC",
                     "OTHER"="OTHER STATE LAWS (NON PENAL LAW)"
                     )) %>%
  
  mutate(ExactTime = as.ITime(CMPLNT_FR_TM)) %>%
  mutate(day=wday(ExactDate,label=TRUE,abbr=TRUE),
         month=month(ExactDate,label=TRUE,abbr=TRUE)) %>%
  
  mutate(Time = case_when(
    CMPLNT_FR_TM >="00:00:00" & CMPLNT_FR_TM <"01:00:00"~0,
    CMPLNT_FR_TM >="01:00:00" & CMPLNT_FR_TM <"02:00:00"~1,
    CMPLNT_FR_TM >="02:00:00" & CMPLNT_FR_TM <"03:00:00"~2,
    CMPLNT_FR_TM >="03:00:00" & CMPLNT_FR_TM <"04:00:00"~3,
    CMPLNT_FR_TM >="04:00:00" & CMPLNT_FR_TM <"05:00:00"~4,
    CMPLNT_FR_TM >="05:00:00" & CMPLNT_FR_TM <"06:00:00"~5,
    CMPLNT_FR_TM >="06:00:00" & CMPLNT_FR_TM <"07:00:00"~6,
    CMPLNT_FR_TM >="07:00:00" & CMPLNT_FR_TM <"08:00:00"~7,
    CMPLNT_FR_TM >="08:00:00" & CMPLNT_FR_TM <"09:00:00"~8,
    CMPLNT_FR_TM >="09:00:00" & CMPLNT_FR_TM <"10:00:00"~9,
    CMPLNT_FR_TM >="10:00:00" & CMPLNT_FR_TM <"11:00:00"~10,
    CMPLNT_FR_TM >="11:00:00" & CMPLNT_FR_TM <"12:00:00"~11,
    CMPLNT_FR_TM >="12:00:00" & CMPLNT_FR_TM <"13:00:00"~12,
    CMPLNT_FR_TM >="13:00:00" & CMPLNT_FR_TM <"14:00:00"~13,
    CMPLNT_FR_TM >="14:00:00" & CMPLNT_FR_TM <"15:00:00"~14,
    CMPLNT_FR_TM >="15:00:00" & CMPLNT_FR_TM <"16:00:00"~15,
    CMPLNT_FR_TM >="16:00:00" & CMPLNT_FR_TM <"17:00:00"~16,
    CMPLNT_FR_TM >="17:00:00" & CMPLNT_FR_TM <"18:00:00"~17,
    CMPLNT_FR_TM >="18:00:00" & CMPLNT_FR_TM <"19:00:00"~18,
    CMPLNT_FR_TM >="19:00:00" & CMPLNT_FR_TM <"20:00:00"~19,
    CMPLNT_FR_TM >="20:00:00" & CMPLNT_FR_TM <"21:00:00"~20,
    CMPLNT_FR_TM >="21:00:00" & CMPLNT_FR_TM <"22:00:00"~21,
    CMPLNT_FR_TM >="22:00:00" & CMPLNT_FR_TM <"23:00:00"~22,
    CMPLNT_FR_TM >="23:00:00" & CMPLNT_FR_TM <"24:00:00" ~23,
    CMPLNT_FR_TM >="24:00:00" ~24))
```


```{r}
crimetype <- crime %>%
  group_by(CrimeType) %>%
  summarize(count=n()) %>%
  arrange(count) %>%
  na_if("") %>%
  na.omit
```


```{r}
crimetype %>% 
  ggplot(aes(x = reorder(CrimeType,count), y = count)) +
  geom_bar(stat = "identity", fill = "purple") +
  labs(x ="Crime Type", y = "Number of crimes", title = "Crimes in New York") + 
  coord_flip()
```
Theft, harassment, assault and criminal mischief occurs much frequently in NYC.  

```{r}
crimedate <- crime %>%
  group_by(ExactDate) %>%
  summarize(count=n())
```

```{r}
crimedate %>%
  ggplot(aes(x=ExactDate, y=count)) +
  geom_line(colour = "blue") + scale_x_date(date_breaks = "1 month") +
  labs(x ="Date", y = "Number of crimes", title = "Crimes by day")
```
It can been seen most crime peaks occurred in the beginning of a month and the middle of a month. Crime incidents happened more frequently in summer month.

```{r}
library(lubridate)
crimemonth <- crime %>%
  group_by(month) %>%
  summarize(count=n())
```


```{r}
crimemonth %>% 
  ggplot(aes(x = month, y = count)) +
  geom_col() +
  labs(x = "Day of week", y = "Number of crimes", title = "Crimes by day of week")
```


```{r}
crimeday <- crime %>% 
  group_by(day) %>%
  summarize(count=n())
```

```{r}
crimeday %>%
  ggplot(aes(x = day, y = count)) +
  geom_col() +
  labs(x = "Day of week", y = "Number of crimes", title = "Crimes by day of week")
```
Histograms shows that there indeed exists a pattern in the occurrence of crime with respect to the dimension of time. Fridays and summer months have higher occurrence of crime incidents with respect to other corresponding time periods.

```{r}
crimetime <- crime %>%
  group_by(Time) %>%
  summarize(count = n()) 
```

```{r}
ggplot(crimetime, aes(x = Time, y = count)) +
  geom_line(colour = "blue", size = 1) +
  scale_x_continuous(breaks=c(0:23)) +
  ggtitle("The total number of crimes by time of day")
```
The latter parts of the day have higher occurrence of crime incidents. There is a peak of crime at hour 16, indicating more incidents take place during the periods 4:00pm - 4:59pm. There are less incidents in the morning periods (1am - 7am). In particular, very few crime incidents happen during the period of 5am.

```{r}
borough <- crime %>%
  select(BORO_NM,Longitude,Latitude,ExactDate) %>%
  na_if("") %>%
  na.omit %>%
  group_by(BORO_NM)  

colnames(borough) <- c('Borough','Longitude','Latitude',"ExactDate")
```

```{r}
borough %>%
  ggplot(aes(x = ExactDate)) +
  geom_histogram(binwidth=5) + scale_x_date(date_breaks = "3 week",date_labels =("%b%d")) + facet_wrap(~Borough)
```
Brooklyn has highest number of crime, and Staten Island has lowest. 

```{r}
ggplot(borough, aes(x = Longitude, y = Latitude)) + geom_point(aes(colour = factor(Borough)), size = 0.1) + 
  theme_light(base_size = 10) + xlab("Longitude") + ylab("Latitude") +
  ggtitle("Borough") + theme(plot.title=element_text(size = 16))
```
There are lesser points landing in Staten Island area than other boroughs. 

```{r}
crime1 <- crime %>%
  group_by(CrimeType,Time) %>%
  summarise(count=n()) %>%
  na_if("") %>%
  na.omit
```

```{r}
crime1 %>%
  ggplot(aes(x=CrimeType, y=Time)) +
  geom_tile(aes(fill=count)) + scale_y_continuous(breaks=c(0:23)) +
  labs(x="Crime Type", y = "Time of day", title="Crime Type VS Time of Day") + coord_flip()
```
The first heat map shows the relationship between crime type and time of day, that is how different crimes vary by different times of the day. It can be found the crime type of theft crimes is the most common crime type with more than 4000 incidents per hours during the period of peak hours from 12pm to 18pm. Harassment(more prevalent in the afternoon), criminal mischief, and assault(more prevalent in the evening and at night) are also common during the day in NYC.

```{r}
crime2 <- crime %>%
  group_by(CrimeType,BORO_NM) %>%
  summarise(count=n()) %>%
  na_if("") %>%
  na.omit
```

```{r}
crime2 %>%
  ggplot(aes(x=CrimeType, y=BORO_NM)) +
  geom_tile(aes(fill=count)) +
  labs(x="Crime Type", y = "Borough", title="Crime Type VS Borough") + coord_flip()
```
The second heat map shows the relationship between crime type and borough.Theft crimes, the most common incident, happens frequently in all borough, but most frequently in Manhattan with more than 30000 incidents. It can also be observed that harassment, criminal mischief, and assault are the common types of crime across boroughs, and they happens most frequently in Brooklyn.

```{r}
crime3 <- crime %>%
  group_by(BORO_NM,Time) %>%
  summarise(count=n()) %>%
  na_if("") %>%
  na.omit
```

```{r}
crime3 %>%
  ggplot(aes(x=BORO_NM, y=Time)) +
  geom_tile(aes(fill=count)) + scale_y_continuous(breaks=c(0:23)) +
  labs(x="Borough", y = "Time of day", title="Borough VS Time of Day") + coord_flip()
```
The third heat map shows the relationship between borough and time of day. It turns out that Brooklyn is the most dangerous borough and there are more than 3000 incidents per hour during periods of 12pm-12:59pm and 4pm-6:59pm. In addition, Manhattan also has high number of crime incidents during 12pm-6:59pm.

```{r}
crime4 <- crime %>%
  group_by(CrimeType,day) %>%
  summarise(count=n()) %>%
  na_if("") %>%
  na.omit
```

```{r}
crime4 %>%
  ggplot(aes(x=CrimeType, y=day)) +
  geom_tile(aes(fill=count)) +
  labs(x="Crime Type", y = "Day of week", title="Crime Type VS Day of week") + coord_flip()
```
The fourth heat map shows the relationship between crime type and day of week. It can be found the crime type of theft crimes is still the most common crime type with higher number of incidents on weekdays than weekends. Whereas, assaults are more prevalent on weekends, and harassment happens frequently almsot every day.

